<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>EDNS(0) Private Option</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre {
  font: 15px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Cache Probe Privacy Attack">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Recursive Resolver Deployments">
<link href="#rfc.section.4" rel="Chapter" title="4 PRIVATE Option">
<link href="#rfc.section.5" rel="Chapter" title="5 Requestor Usage and Behavior">
<link href="#rfc.section.6" rel="Chapter" title="6 Responder Usage and Behavior">
<link href="#rfc.section.7" rel="Chapter" title="7 DNS-over-HTTPS Application">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Privacy Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Artificial Delays">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Delay Distributions">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.9 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Gudmundsson, O., Sullivan, N., and C. Wood" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-wood-dprive-edns0-privacy-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-09-26" />
  <meta name="dct.abstract" content="This document specifies the EDNS(0) &#8220;Private&#8221; option, which allows DNS clients to signal to servers (recursive resolvers) that query answers should not be cached. This option is intended to mitigate cache probing attacks on DNS query privacy." />
  <meta name="description" content="This document specifies the EDNS(0) &#8220;Private&#8221; option, which allows DNS clients to signal to servers (recursive resolvers) that query answers should not be cached. This option is intended to mitigate cache probing attacks on DNS query privacy." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">O. Gudmundsson</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">N. Sullivan</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">Cloudflare Inc.</td>
</tr>
<tr>
<td class="left">Expires: March 30, 2019</td>
<td class="right">C. Wood</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Apple Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 26, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">EDNS(0) Private Option<br />
  <span class="filename">draft-wood-dprive-edns0-privacy-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the EDNS(0) &#8220;Private&#8221; option, which allows DNS clients to signal to servers (recursive resolvers) that query answers should not be cached. This option is intended to mitigate cache probing attacks on DNS query privacy.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 30, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Cache Probe Privacy Attack</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Recursive Resolver Deployments</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">PRIVATE Option</a>
</li>
<li>5.   <a href="#rfc.section.5">Requestor Usage and Behavior</a>
</li>
<li>6.   <a href="#rfc.section.6">Responder Usage and Behavior</a>
</li>
<li>7.   <a href="#rfc.section.7">DNS-over-HTTPS Application</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Privacy Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgments</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<ul><li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Artificial Delays</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Delay Distributions</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Domain Name System (DNS) <a href="#RFC1035" class="xref">[RFC1035]</a> was designed to transport all messages in cleartext. This provides no privacy, confidentiality, or integrity (in the absence of DNSSEC <a href="#RFC4033" class="xref">[RFC4033]</a>) for all client queries and responses against a network adversary.  <a href="#RFC7858" class="xref">[RFC7858]</a> standardizes running DNS over (D)TLS to protect data in transit.</p>
<p id="rfc.section.1.p.2">Even if data is protected in transit, the current caching behavior of recursive DNS resolvers introduces a side channel for an active network adversary to learn queries made by other clients.  Specifically, in response to a client&#8217;s query, a recursive resolver will fetch the corresponding record by traversing the DNS hierarchy and cache it to more efficiently respond to the same query in the future.  Returning a cached record is expected to be faster than making network requests to fetch it and that timing difference is observable by the client making the query.  Because the cache is shared by all clients, if a client observes a fast response time for a given query it can infer that some other client has already made that query in the past.  Malicious clients may exploit this caching behavior to use the cache as an oracle for the network activity of other clients.</p>
<p id="rfc.section.1.p.3">In this document, we propose a new EDNS(0) option that allows clients to mark queries as privacy sensitive. We specify recursive behavior when processing private queries and caching their responses. Usage of this option SHOULD only be enabled when running over a spoofing-resistant transport such as TCP, as recursive resolvers may choose to cache responses in per-user caches identified by network information such as the source port and IP.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The terms &#8220;Requestor&#8221; and &#8220;Responder&#8221; are to be interpreted as specified in <a href="#RFC6891" class="xref">[RFC6891]</a>.</p>
<p></p>

<ul><li>Private query: A query carrying the PRIVATE EDNS(0) option.</li></ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#attacks" id="attacks">Cache Probe Privacy Attack</a>
</h1>
<p id="rfc.section.3.p.1">Securing DNS traffic in transit via DNS-over-TLS has many benefits. Minimally, it prevents eavesdroppers observing queries and responses in transit. However, as this only protects the data channel, other privacy attacks remain possible. In this document, we focus solely on the cache probe attack outlined in Section <a href="#introduction" class="xref">Section 1</a>. We describe the attack in more detail here.</p>
<p id="rfc.section.3.p.2">Let S be a benign client (requestor) using recursive resolver (responder) R.  In answering S&#8217;s queries, R speaks to several authoritative servers A1,&#8230;,An.  Let RTT(requestor, responder) be a function that computes the average RTT for a given query and response between requestor and responder. For example, RTT(R,A1) is the average RTT for answering a query sent by R and answered by A1. Let Delay(q, r) be a function that measures the delay in answering request q with response r.  Finally, let Adv be a malicious client who wishes to learn what queries were asked by S.  Adv proceeds as follows. Assume Adv wants to learn if S queried for q = example.com.  To do so, Adv requests q from R, yielding response r, and measures d = delay(q, r). Then, Adv sends a random query q&#8217; in the same top-level domain (e.g., .com), yielding response r&#8217;, that S is unlikely to have requested, and measures d&#8217; = delay(q&#8217;, r&#8217;).  If |d - d&#8217;| ~ 0, then Adv concludes q was not requested by S (or someone else). Otherwise, Adv concludes that, with some probability q was requested.</p>
<p id="rfc.section.3.p.3">Severity of this attack depends on several factors:</p>
<p></p>

<ul>
<li>How many clients (stubs) are served by R.</li>
<li>What types of queries are requested by other clients of R. For example, do they require more recursive resolution steps to resolve? If so, this may inflate time required to answer the query.</li>
</ul>
<p id="rfc.section.3.p.5">While learning the existence of a certain query may not always constitute a privacy violation, it may for some clients.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#recursive-resolver-deployments" id="recursive-resolver-deployments">Recursive Resolver Deployments</a>
</h1>
<p id="rfc.section.3.1.p.1">Large-scale recursive resolvers, such as those operated by Quad9, Cloudflare, and Google, traditionally deploy several servers behind well known anycast IP addresses, such as 8.8.8.8 or 9.9.9.9. Thus, stub queries to such well known resolvers may not be serviced by the same logical recursive resolver. UDP queries and TCP connections may be routed to different resolvers based on distance and connection cost.  This increases the difficulty of cache probing attacks. Recursive resolvers that are not deployed at such large scales are more susceptible to this type of attack.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#private-option" id="private-option">PRIVATE Option</a>
</h1>
<p id="rfc.section.4.p.1">EDNS(0) <a href="#RFC6891" class="xref">[RFC6891]</a> specifies a mechanism to include new options in DNS messages.  This document specifies a new &#8220;PRIVATE&#8221; option that allows clients to express the maximum desired cache lifetime for DNS query answers.</p>
<pre>
0                       8                      16
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                  OPTION-CODE                  |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                 OPTION-LENGTH                 |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|    PRIVATE Option     |
+--+--+--+--+--+--+--+--+
</pre>
<p id="rfc.section.4.p.2">The OPTION-CODE for the &#8220;PRIVATE&#8221; option is TBD.</p>
<p id="rfc.section.4.p.3">The OPTION-LENGTH for the &#8220;PRIVATE&#8221; option is one octet.</p>
<p id="rfc.section.4.p.4">The PRIVATE octet MUST be set to 0x01. Presence of this option indicates that a query is private. Other values MUST NOT be used. Responders, such as recursive resolvers, MUST drop the query if another value is set, as discussed in Section <a href="#usage-recursive" class="xref">Section 6</a>.</p>
<p id="rfc.section.4.p.5">This option does not affect intermediate queries performed to produce an answer to a query. Responders MUST only honor it for the final answer. For example, when answering a query for a.b.c.d.example.com, only the final answer for a.b.c.d.example.com is affected. All intermediate queries, e.g., for .com, .example.com, etc., MAY be cached as needed.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#usage-stub" id="usage-stub">Requestor Usage and Behavior</a>
</h1>
<p id="rfc.section.5.p.1">Requestors MAY include a &#8220;PRIVATE&#8221; option for any query deemed private or sensitive. This may include queries for explicitly known-to-be private domains or for all domains when operating in a &#8220;private&#8221; mode. Specific recommendations for when to include this option are outside the scope of this document.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#usage-recursive" id="usage-recursive">Responder Usage and Behavior</a>
</h1>
<p id="rfc.section.6.p.1">Responders MUST NOT use cached responses to serve answers to private requests. If the answer for a private query is not cached, responders MUST NOT cache the final answer for longer than N seconds.  N is a deployment- and instance-specific variable that changes based on responder load and client pool. Larger values of N make probing attacks more feasible. If the answer for a private query is cached, responders MUST NOT use the final answer to update the existing cached entry.  Responders MAY cache any intermediate answer used to produce the final response.</p>
<p id="rfc.section.6.p.2">[[OPEN ISSUE: determine if N &gt; 0 is an acceptable trade-off]]</p>
<p id="rfc.section.6.p.3">In cases where responders need to reduce upstream redundant queries, e.g., because they are expensive or otherwise reveal more information to authoritative servers, there are (at least) responders MAY adjust their cache policy to handle private queries with per-client, segmented caches. This approach works as follows:</p>
<p id="rfc.section.6.p.4">Responders that receive a query Q without the &#8220;Private&#8221; options may treat it as normal, i.e., by serving a response from cache if available. For a query Q with a &#8220;Private&#8221; option sent from client S, responders MUST do the following:</p>
<p></p>

<ul>
<li>Index S&#8217;s private cache using Q, if it exists. If response R is present, serve it to S.</li>
<li>If S&#8217;s private cache does not exist, attempt to resolve Q as normal. Cache the response in S&#8217;s private cache.</li>
</ul>
<p id="rfc.section.6.p.6">When S&#8217;s connection to R is torn down, S&#8217;s private cache MUST be flushed and memory released.  Responders SHOULD apply whatever per-client caching policy is sensible to balance utility amongst shared (non-private) and private caches. Segmented caches introduce more memory requirements for resolvers at the cost of improving client privacy.</p>
<p id="rfc.section.6.p.7">This approach is only viable when clients connect to resolvers over a mechanism that provides the server with a way to uniquely identify clients in a validated way.  For transports such as DNS-over-HTTPS (DOH) <a href="#I-D.ietf-doh-dns-over-https" class="xref">[I-D.ietf-doh-dns-over-https]</a>, this can be the incoming IP and port pair, or a client certificate. Otherwise, malicious clients may flood resolvers with private queries and induce cache fragmentation.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#dns-over-https-application" id="dns-over-https-application">DNS-over-HTTPS Application</a>
</h1>
<p id="rfc.section.7.p.1">A similar per-query &#8220;no-cache&#8221; flag may be implemented with DNS-over-HTTPS <a href="#I-D.ietf-doh-dns-over-https" class="xref">[I-D.ietf-doh-dns-over-https]</a> by appending a random nonce to each request. Specifically, given a random N-byte nonce R, the following query parameter can be appended to a DOH query:</p>
<pre>
?rand=R
</pre>
<p id="rfc.section.7.p.2">DOH recursive resolvers that use an HTTP caching layer to satisfy duplicate queries SHOULD not satisfy cached queries with the same &#8220;dns&#8221; parameter yet different (or no) &#8220;rand&#8221; parameter.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">((TODO: codepoint for option type))</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.9.p.1">Clients that malicious mark all queries as private may induce excessive upstream responder traffic while responding said queries. However, as malicious clients may do this today by issuing queries for nonsensical or nonexistent domains, this does not introduce a new attack vector.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#privacy-considerations" id="privacy-considerations">Privacy Considerations</a>
</h1>
<p id="rfc.section.10.p.1">Selectively sending a private DNS query based on user behavior leaks information about user behavior or system policy. For example, if clients only send private queries while in a certain system configuration, then presence of a &#8220;Private&#8221; option indicates, with high probability, that the origin user&#8217;s device is in such a configuration. This could be addressed by marking queries as private &#8211; at random or unilaterally &#8211; such that system configurations are indistinguishable under observation of the &#8220;Private&#8221; option.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.11.p.1">The authors thank Georgios Kontaxis for feedback on earlier versions of this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Acs17">[Acs17]</b></td>
<td class="top">"<a href="http://ieeexplore.ieee.org/document/7874168/">Privacy-Aware Caching in Information-Centric Networking</a>", n.d..</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-dprive-padding-policy">[I-D.ietf-dprive-padding-policy]</b></td>
<td class="top">
<a>Mayrhofer, A.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-dprive-padding-policy-06">Padding Policy for EDNS(0)</a>", Internet-Draft draft-ietf-dprive-padding-policy-06, July 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-tls-tls13">[I-D.ietf-tls-tls13]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-28">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-28, March 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a>Mockapetris, P.</a>, "<a href="https://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, DOI 10.17487/RFC1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2104">[RFC2104]</b></td>
<td class="top">
<a>Krawczyk, H.</a>, <a>Bellare, M.</a> and <a>R. Canetti</a>, "<a href="https://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>", RFC 2104, DOI 10.17487/RFC2104, February 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4033">[RFC4033]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="https://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>", RFC 4033, DOI 10.17487/RFC4033, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5077">[RFC5077]</b></td>
<td class="top">
<a>Salowey, J.</a>, <a>Zhou, H.</a>, <a>Eronen, P.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/rfc5077">Transport Layer Security (TLS) Session Resumption without Server-Side State</a>", RFC 5077, DOI 10.17487/RFC5077, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6891">[RFC6891]</b></td>
<td class="top">
<a>Damas, J.</a>, <a>Graff, M.</a> and <a>P. Vixie</a>, "<a href="https://tools.ietf.org/html/rfc6891">Extension Mechanisms for DNS (EDNS(0))</a>", STD 75, RFC 6891, DOI 10.17487/RFC6891, April 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7830">[RFC7830]</b></td>
<td class="top">
<a>Mayrhofer, A.</a>, "<a href="https://tools.ietf.org/html/rfc7830">The EDNS(0) Padding Option</a>", RFC 7830, DOI 10.17487/RFC7830, May 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7858">[RFC7858]</b></td>
<td class="top">
<a>Hu, Z.</a>, <a>Zhu, L.</a>, <a>Heidemann, J.</a>, <a>Mankin, A.</a>, <a>Wessels, D.</a> and <a>P. Hoffman</a>, "<a href="https://tools.ietf.org/html/rfc7858">Specification for DNS over Transport Layer Security (TLS)</a>", RFC 7858, DOI 10.17487/RFC7858, May 2016.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="I-D.ietf-doh-dns-over-https">[I-D.ietf-doh-dns-over-https]</b></td>
<td class="top">
<a>Hoffman, P.</a> and <a>P. McManus</a>, "<a href="https://tools.ietf.org/html/draft-ietf-doh-dns-over-https-14">DNS Queries over HTTPS (DoH)</a>", Internet-Draft draft-ietf-doh-dns-over-https-14, August 2018.</td>
</tr></tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#artificial-delays" id="artificial-delays">Artificial Delays</a>
</h1>
<p id="rfc.section.A.p.1">An alternative mechanism to support caching without inducing upstream traffic is for responders to &#8220;ignore&#8221; cached responses and emulate fetch delays for queries marked private. This variation may work as follows:</p>
<p id="rfc.section.A.p.2">Responders that receive a query Q with &#8220;Private&#8221; options MUST do one of the following to satisfy Q:</p>
<p></p>

<ol>
<li>If response R is not cached, resolve Q using upstream authoritative or recursive resolvers.</li>
<li>If response R is cached, ignore R and attempt to resolve Q using upstream authoritative or recursive resolvers.</li>
<li>If response R is cached, delay sending R to the requestor until some time T has passed. T is a random variable with distribution equal to the resolution distribution time of R.</li>
</ol>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#delay-distributions" id="delay-distributions">Delay Distributions</a>
</h1>
<p id="rfc.section.A.1.p.1">T measurement and distribution estimation is critical for masking the timing side channel described in Section <a href="#introduction" class="xref">Section 1</a>. Both should be chosen to maximize requestor utility while minimizing responder overhead.  We draw on observations and experiments by <a href="#Acs17" class="xref">[Acs17]</a> in deciding these factors.</p>
<p id="rfc.section.A.1.p.2">Responders SHOULD measure query resolution time T&#8217; and use this in selecting T&#8217;s distribution. There are two recommended delay strategies for responders assuming knowledge of T&#8217;, including:</p>
<p></p>

<ol>
<li>Uniform: Delay for some time T* that is selected uniformly at random in the range [0, T&#8217;], i.e,. with probability distribution function Pr[T = t] = 1/T&#8217;.</li>
<li>Geometric: Delay for some time T* that is selected according to a geometric distribution, i.e., with probability distribution function Pr[T = t] = (1 - t) * t^k, where k is a parameter for the distribution.</li>
</ol>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Olafur Gudmundsson</span> 
	  <span class="n hidden">
		<span class="family-name">Gudmundsson</span>
	  </span>
	</span>
	<span class="org vcardline">Cloudflare Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:olafur+ietf@cloudflare.com">olafur+ietf@cloudflare.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Nick Sullivan</span> 
	  <span class="n hidden">
		<span class="family-name">Sullivan</span>
	  </span>
	</span>
	<span class="org vcardline">Cloudflare Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:nick@cloudflare.com">nick@cloudflare.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Christopher A. Wood</span> 
	  <span class="n hidden">
		<span class="family-name">Wood</span>
	  </span>
	</span>
	<span class="org vcardline">Apple Inc.</span>
	<span class="adr">
	  <span class="vcardline">1 Infinite Loop</span>

	  <span class="vcardline">
		<span class="locality">Cupertino, California 95014</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United States of America</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:cawood@apple.com">cawood@apple.com</a></span>

  </address>
</div>

</body>
</html>
